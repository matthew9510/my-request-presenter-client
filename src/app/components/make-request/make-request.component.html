<ng-container *transloco="let t; read: 'make request'">
  <h1 mat-dialog-title>{{ title }}</h1>
  <mat-dialog-content>
    <!-- Error messages for song and amount inputs -->
    <div
      *ngIf="submitErrorMessage && showSubmitErrorMessage"
      class="notification is-error"
    >
      {{ submitErrorMessage }}
    </div>
    <!-- <div *ngIf="amount.invalid && amount.dirty" class="notification is-error">
      The tip amount entered is not a valid number.
    </div>
    <div *ngIf="song.invalid && song.touched" class="notification is-error">
      The song name is required.
    </div> -->

    <form [formGroup]="requestForm">
      <!-- **************************************************************************** -->
      <!-- Top Up Form -->
      <div *ngIf="isTopUp; else isNewRequest">
        <div class="top-up-form">
          <p class="top-up-song">
            <b>{{ requestForm.value.song }}</b>
            <span *ngIf="requestForm.value.artist">
              by {{ requestForm.value.artist }}<br />
            </span>
            <br />
          </p>
          <mat-form-field appearance="fill" floatLabel="always">
            <mat-label>{{ t("tip label") }}</mat-label>
            <input
              matInput
              type="string"
              formControlName="amount"
              placeholder="0.00"
            />
            <span matPrefix>$</span>
            <mat-error *ngIf="amount.invalid && amount.dirty">
              Must be a valid dollar amount
            </mat-error>
          </mat-form-field>
          <br />
          <!-- First name input -->
          <!-- <mat-form-field class="name-input">
            <mat-label>{{ t("first name label") }}</mat-label>
            <input matInput type="text" formControlName="firstName" />
          </mat-form-field> -->
          <!-- Last name input -->
          <!-- <mat-form-field class="name-input">
            <mat-label>{{ t("last name label") }}</mat-label>
            <input matInput type="text" formControlName="lastName" />
          </mat-form-field> -->
        </div>
        <div *ngIf="success" class="notification is-success">
          {{ t("form success message") }}
        </div>

        <!-- Submit top up form -->
        <div *ngIf="loading === false; else progressBar">
          <div class="stepper-buttons">
            <button
              class="form-submit-button"
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="requestForm.invalid || loading === true"
              id="input2"
              (click)="submitHandler()"
            >
              {{ t("submit button") }}
            </button>
          </div>
        </div>
        <ng-template #progressBar>
          <mat-progress-bar mode="indeterminate"></mat-progress-bar>
        </ng-template>
      </div>

      <!-- **************************************************************************** -->
      <!-- Make new request form -->
      <ng-template #isNewRequest>
        <!-- Song title input -->
        <mat-form-field appearance="fill">
          <mat-label>{{ t("song label") }}</mat-label>
          <input matInput formControlName="song" required id="input0" #input0 />
          <mat-error *ngIf="song.invalid && song.touched">
            {{ t("song input error msg") }}
          </mat-error>
        </mat-form-field>

        <!-- Artist name input -->
        <mat-form-field appearance="fill">
          <mat-label>{{ t("artist label") }}</mat-label>
          <input matInput formControlName="artist" />
        </mat-form-field>

        <!-- Tip amount input -->
        <mat-form-field appearance="fill">
          <mat-label>{{ t("tip label") }}</mat-label>
          <input matInput type="string" formControlName="amount" />
          <mat-error *ngIf="amount.invalid && amount.dirty">
            Must be a valid dollar amount
          </mat-error>
          <span matPrefix>$</span>
        </mat-form-field>

        <!-- Memo input -->
        <mat-form-field appearance="fill">
          <mat-label>{{ t("memo label") }}</mat-label>
          <textarea
            matInput
            formControlName="memo"
            id="input1"
            #input1
          ></textarea>
        </mat-form-field>
        <!-- First name input -->
        <!-- <mat-form-field>
          <mat-label>{{ t("first name label") }}</mat-label>
          <input matInput type="text" formControlName="firstName" />
        </mat-form-field> -->
        <!-- Last name input -->
        <!-- <mat-form-field>
          <mat-label>{{ t("last name label") }}</mat-label>
          <input matInput type="text" formControlName="lastName" />
        </mat-form-field> -->

        <!-- Step 3 / Review and submit -->
        <!-- <div>
          <h4>Your Request Details</h4>
          <p>
            <b>Song Name:</b> {{ requestForm.value.song }}<br />
            <span *ngIf="requestForm.value.artist"
              ><b>Artist:</b> {{ requestForm.value.artist }}<br
            /></span>
            <span *ngIf="requestForm.value.amount"
              ><b>Tip:</b> {{ requestForm.value.amount | currency }}<br
            /></span>
            <span *ngIf="requestForm.value.memo"
              ><b>Memo:</b> {{ requestForm.value.memo }}<br
            /></span>
            <span
              *ngIf="requestForm.value.firstName || requestForm.value.lastName"
              ><b>Name:</b> {{ requestForm.value.firstName }}
              {{ requestForm.value.lastName }}</span
            >
          </p>
        </div> -->
        <div *ngIf="success" class="notification is-success">
          {{ t("form success message") }}
        </div>

        <div *ngIf="loading === false; else progressBar">
          <div class="stepper-buttons">
            <button
              class="form-submit-button"
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="requestForm.invalid || loading === true"
              id="input2"
              #input2
              (click)="submitHandler()"
            >
              {{ t("submit button") }}
            </button>
          </div>
        </div>
      </ng-template>
      <ng-template #progressBar>
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      </ng-template>
    </form>
  </mat-dialog-content>
</ng-container>
